\documentclass{article}
\usepackage{expl3}
\ExplSyntaxOn

%% The weighted stack is just a stack that associates nodes with
%% weights (or priorities, depending on how you look at it).  When a
%% node is pushed onto the stack, it will pop all those nodes with a
%% weight greater than or equal to its own.

\cs_new:Nn \__ws_get_values:N
  {
    % using typeout *only* for quick debug purposes.
    % these will be converted to proper l3msgs.
    \cs_to_str:N #1 _values_seq
  }

\cs_new:Nn \__ws_get_weights:N
  {
    \cs_to_str:N #1 _weights_seq
  }

\cs_new:Nn \ws_new:N
  {
    \cs_new:Npn #1 { \ws_show:N #1 }
    \seq_new:c { \__ws_get_values:N  #1 }
    \seq_new:c { \__ws_get_weights:N #1 }
  }

% Pushes #2 onto #1 with weight #3.  #3 must be an integer expression.
\cs_new:Nn \ws_push:Nnn
  {
    \seq_get:cNTF
      { \__ws_get_weights:N #1 }
      \g_tmpa_int % put the weight into this temp variable
      {
        % Keep popping the stack (and updating our current weight)
        % until either the stack is empty or the current weight is
        % less than the one we wish to add
        \bool_until_do:nn
          {
            \seq_if_empty_p:N
            ||
            \int_compare_p:n { \g_tmpa_int < #3 }
          }
          {
            % Pop the stack and throw away the value and weight
            \__ws_gpop:NNN #1 \l_tmpa_tl \l_tmpa_int

            % Update the current weight on the stack
            \seq_get:cN { \__ws_get_weights:N #1 } \l_tmpa_int

            % And copy it into our global variable for comparison
            \int_gset_eq:NN \g_tmpa_int \l_tmpa_int
          }
      } { }


    % After we have removed all necessary values, push this one onto the stack
    \seq_push:cn
      { \__ws_get_values:N #1 }
      { #2 }
    \seq_push:cn
      { \__ws_get_weights:N #1 }
      { #3 }
  }

% Pop the stack
\cs_new:Nn \__ws_gpop:NNN
  {
    % Pop the value stack and throw it away
    \seq_gpop:NN { \__ws_get_values:N  #1 } #2
    
    % Pop the weight stack and throw it away
    \seq_gpop:NN { \__ws_get_weights:N #1 } #3
  }

% prints the values in the stack to the terminal
\cs_new:Nn \ws_show:N
  {
    \seq_show:c { \__ws_get_values:N #1 }
  }

% places the values of the stack in the input stream
\cs_new:Nn \ws_use:Nn
  {
    \seq_use:cn { \__ws_get_values:N #1 } { #2 }
  }

\begin{document}
test\par

\ws_new:N \l_simple_ws

\ws_show:N \l_simple_ws

\ws_push:Nnn \l_simple_ws
  { some value }
  { 1 }

% \ws_use:Nn \l_simple_ws {~and~}

\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
